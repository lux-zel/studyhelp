import{initializeApp as h}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";import{getAuth as w,GithubAuthProvider as I,onAuthStateChanged as E,signInWithEmailAndPassword as v,createUserWithEmailAndPassword as P,sendEmailVerification as b,signOut as B,sendPasswordResetEmail as L}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";import{getFirestore as x}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const A={apiKey:"AIzaSyCLFyJEgzqJw4sSxYoJfaiEklVJp3LTl2g",authDomain:"learn-better-together-21ddd.firebaseapp.com",projectId:"learn-better-together-21ddd",storageBucket:"learn-better-together-21ddd.firebasestorage.app",messagingSenderId:"836724963210",appId:"1:836724963210:web:e3cbec9877d3868534ba73",measurementId:"G-NGZS2PDF69"},g=h(A),o=w(g);x(g);new I;const m=new Map,C=6e4,k=5;function c(e){const t=Date.now(),s=(m.get(e)||[]).filter(r=>t-r<C);return s.length>=k?!1:(s.push(t),m.set(e,s),!0)}function u(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&e.length<=254}function T(e){return e&&e.length>=8}function l(e){return{"auth/email-already-in-use":"Email already in use. Try logging in instead.","auth/invalid-email":"Invalid email address.","auth/weak-password":"Password is too weak.","auth/user-not-found":"No account found with this email.","auth/wrong-password":"Incorrect password.","auth/too-many-requests":"Too many attempts. Please try again later.","auth/operation-not-allowed":"This operation is not allowed.","auth/invalid-credential":"Invalid email or password."}[e.code]||"An error occurred. Please try again."}function a(e,t=!1){const n=document.getElementById("message");n&&(n.textContent=e,n.style.display="block",n.style.backgroundColor=t?"#f8d7da":"#d4edda",n.style.color=t?"#721c24":"#155724",n.style.border=t?"1px solid #f5c6cb":"1px solid #c3e6cb",n.style.padding="10px",n.style.margin="10px 0",n.style.borderRadius="4px",setTimeout(()=>{n.style.display="none"},5e3))}E(o,e=>{if(e){const t=document.getElementById("auth-container"),n=document.getElementById("user-container");t&&(t.style.display="none"),n&&(n.style.display="block");const s=document.getElementById("user-email"),r=document.getElementById("display-email"),i=document.getElementById("email-verified");s&&(s.textContent=p(e.email)),r&&(r.textContent=p(e.email)),i&&(i.textContent=e.emailVerified?"✅ Yes":"❌ No")}else{const t=document.getElementById("auth-container"),n=document.getElementById("user-container");t&&(t.style.display="block"),n&&(n.style.display="none")}});function p(e){const[t,n]=e.split("@");return`${t.slice(0,2)+"*".repeat(Math.max(0,t.length-2))}@${n}`}async function M(){const e=document.getElementById("email"),t=document.getElementById("password");if(!e||!t)return;const n=e.value.trim(),s=t.value;if(!n||!s){a("Please enter both email and password",!0);return}if(!u(n)){a("Please enter a valid email address",!0);return}if(!T(s)){a("Password must be at least 8 characters",!0);return}if(!c(`signup_${n}`)){a("Too many signup attempts. Please try again later.",!0);return}try{const r=await P(o,n,s);await b(r.user),a("Account created! Please check your email for verification link."),e.value="",t.value=""}catch(r){a(l(r),!0)}}async function y(){const e=document.getElementById("email"),t=document.getElementById("password");if(!e||!t)return;const n=e.value.trim(),s=t.value;if(!n||!s){a("Please enter both email and password",!0);return}if(!u(n)){a("Please enter a valid email address",!0);return}if(!c(`signin_${n}`)){a("Too many login attempts. Please try again later.",!0);return}try{await v(o,n,s),a("Login successful!"),e.value="",t.value=""}catch(r){a(l(r),!0)}}async function O(){try{await B(o),a("Logged out successfully")}catch(e){a(l(e),!0)}}async function N(){const e=document.getElementById("email");let t=e?e.value.trim():"";if(!t&&(t=prompt("Enter your email address:"),!t)){a("Please enter your email address",!0);return}if(!u(t)){a("Please enter a valid email address",!0);return}if(!c(`reset_${t}`)){a("Too many password reset attempts. Please try again later.",!0);return}try{await L(o,t),a("Password reset email sent! Check your inbox.")}catch(n){a(l(n),!0)}}const f=document.getElementById("password");f&&f.addEventListener("keypress",e=>{e.key==="Enter"&&y()});document.getElementById("signUpBtn").addEventListener("click",M);document.getElementById("signInBtn").addEventListener("click",y);document.getElementById("signOutBtn").addEventListener("click",O);document.getElementById("resetPasswordLink").addEventListener("click",function(e){e.preventDefault(),N()});
