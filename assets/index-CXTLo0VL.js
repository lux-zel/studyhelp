import{initializeApp as w}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";import{getAuth as E,GithubAuthProvider as I,onAuthStateChanged as v,signInWithEmailAndPassword as P,createUserWithEmailAndPassword as b,sendEmailVerification as B,signOut as L,sendPasswordResetEmail as x}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";import{getFirestore as A}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const C={apiKey:"AIzaSyCLFyJEgzqJw4sSxYoJfaiEklVJp3LTl2g",authDomain:"learn-better-together-21ddd.firebaseapp.com",projectId:"learn-better-together-21ddd",storageBucket:"learn-better-together-21ddd.firebasestorage.app",messagingSenderId:"836724963210",appId:"1:836724963210:web:e3cbec9877d3868534ba73",measurementId:"G-NGZS2PDF69"},g=w(C),o=E(g);A(g);new I;const p=new Map,k=6e4,T=5;function u(t){const e=Date.now(),a=(p.get(t)||[]).filter(r=>e-r<k);return a.length>=T?!1:(a.push(e),p.set(t,a),!0)}function m(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&t.length<=254}function M(t){return t&&t.length>=8}function d(t){return{"auth/email-already-in-use":"Email already in use. Try logging in instead.","auth/invalid-email":"Invalid email address.","auth/weak-password":"Password is too weak.","auth/user-not-found":"No account found with this email.","auth/wrong-password":"Incorrect password.","auth/too-many-requests":"Too many attempts. Please try again later.","auth/operation-not-allowed":"This operation is not allowed.","auth/invalid-credential":"Invalid email or password."}[t.code]||"An error occurred. Please try again."}function s(t,e=!1){const n=document.getElementById("message");n&&(n.textContent=t,n.style.display="block",n.style.backgroundColor=e?"#f8d7da":"#d4edda",n.style.color=e?"#721c24":"#155724",n.style.border=e?"1px solid #f5c6cb":"1px solid #c3e6cb",n.style.padding="10px",n.style.margin="10px 0",n.style.borderRadius="4px",setTimeout(()=>{n.style.display="none"},5e3))}v(o,t=>{if(t){const e=document.getElementById("auth-container"),n=document.getElementById("user-container");e&&(e.style.display="none"),n&&(n.style.display="block");const a=document.getElementById("user-email"),r=document.getElementById("display-email"),i=document.getElementById("email-verified");a&&(a.textContent=f(t.email)),r&&(r.textContent=f(t.email)),i&&(i.textContent=t.emailVerified?"Yes":"No")}else{const e=document.getElementById("auth-container"),n=document.getElementById("user-container");e&&(e.style.display="block"),n&&(n.style.display="none")}});function f(t){const[e,n]=t.split("@");return`${e.slice(0,2)+"*".repeat(Math.max(0,e.length-2))}@${n}`}async function O(){const t=document.getElementById("email"),e=document.getElementById("password");if(!t||!e)return;const n=t.value.trim(),a=e.value;if(!n||!a){s("Please enter both email and password",!0);return}if(!m(n)){s("Please enter a valid email address",!0);return}if(!M(a)){s("Password must be at least 8 characters",!0);return}if(!u(`signup_${n}`)){s("Too many signup attempts. Please try again later.",!0);return}try{const r=await b(o,n,a);await B(r.user),s("Account created! Please check your email for verification link."),t.value="",e.value=""}catch(r){s(d(r),!0)}}async function h(){const t=document.getElementById("email"),e=document.getElementById("password");if(!t||!e)return;const n=t.value.trim(),a=e.value;if(!n||!a){s("Please enter both email and password",!0);return}if(!m(n)){s("Please enter a valid email address",!0);return}if(!u(`signin_${n}`)){s("Too many login attempts. Please try again later.",!0);return}try{await P(o,n,a),s("Login successful!"),t.value="",e.value=""}catch(r){s(d(r),!0)}}async function N(){try{await L(o),s("Logged out successfully")}catch(t){s(d(t),!0)}}async function S(){const t=document.getElementById("email");let e=t?t.value.trim():"";if(!e&&(e=prompt("Enter your email address:"),!e)){s("Please enter your email address",!0);return}if(!m(e)){s("Please enter a valid email address",!0);return}if(!u(`reset_${e}`)){s("Too many password reset attempts. Please try again later.",!0);return}try{await x(o,e),s("Password reset email sent! Check your inbox.")}catch(n){s(d(n),!0)}}const y=document.getElementById("password");y&&y.addEventListener("keypress",t=>{t.key==="Enter"&&h()});const l=t=>new Promise(e=>{const n=document.getElementById(t);if(n)return e(n);const a=new MutationObserver(()=>{const r=document.getElementById(t);r&&(a.disconnect(),e(r))});a.observe(document.body,{childList:!0,subtree:!0})});Promise.all([l("signUpBtn"),l("signInBtn"),l("signOutBtn"),l("resetPasswordLink")]).then(([t,e,n,a])=>{t.addEventListener("click",O),e.addEventListener("click",h),n.addEventListener("click",N),a.addEventListener("click",r=>{r.preventDefault(),S()})});
