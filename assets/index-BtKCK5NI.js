import{initializeApp as h}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";import{getAuth as w,onAuthStateChanged as I,signInWithEmailAndPassword as E,createUserWithEmailAndPassword as v,sendEmailVerification as P,signOut as B,sendPasswordResetEmail as b}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";import{getFirestore as L}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const x={apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:"",measurementId:""},y=h(x),o=w(y);L(y);const m=new Map,C=6e4,k=5;function c(e){const t=Date.now(),s=(m.get(e)||[]).filter(a=>t-a<C);return s.length>=k?!1:(s.push(t),m.set(e,s),!0)}function u(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&e.length<=254}function A(e){return e&&e.length>=8}function l(e){return{"auth/email-already-in-use":"Email already in use. Try logging in instead.","auth/invalid-email":"Invalid email address.","auth/weak-password":"Password is too weak.","auth/user-not-found":"No account found with this email.","auth/wrong-password":"Incorrect password.","auth/too-many-requests":"Too many attempts. Please try again later.","auth/operation-not-allowed":"This operation is not allowed.","auth/invalid-credential":"Invalid email or password."}[e.code]||"An error occurred. Please try again."}function r(e,t=!1){const n=document.getElementById("message");n&&(n.textContent=e,n.style.display="block",n.style.backgroundColor=t?"#f8d7da":"#d4edda",n.style.color=t?"#721c24":"#155724",n.style.border=t?"1px solid #f5c6cb":"1px solid #c3e6cb",n.style.padding="10px",n.style.margin="10px 0",n.style.borderRadius="4px",setTimeout(()=>{n.style.display="none"},5e3))}I(o,e=>{if(e){const t=document.getElementById("auth-container"),n=document.getElementById("user-container");t&&(t.style.display="none"),n&&(n.style.display="block");const s=document.getElementById("user-email"),a=document.getElementById("display-email"),i=document.getElementById("email-verified");s&&(s.textContent=p(e.email)),a&&(a.textContent=p(e.email)),i&&(i.textContent=e.emailVerified?"✅ Yes":"❌ No")}else{const t=document.getElementById("auth-container"),n=document.getElementById("user-container");t&&(t.style.display="block"),n&&(n.style.display="none")}});function p(e){const[t,n]=e.split("@");return`${t.slice(0,2)+"*".repeat(Math.max(0,t.length-2))}@${n}`}async function T(){const e=document.getElementById("email"),t=document.getElementById("password");if(!e||!t)return;const n=e.value.trim(),s=t.value;if(!n||!s){r("Please enter both email and password",!0);return}if(!u(n)){r("Please enter a valid email address",!0);return}if(!A(s)){r("Password must be at least 8 characters",!0);return}if(!c(`signup_${n}`)){r("Too many signup attempts. Please try again later.",!0);return}try{const a=await v(o,n,s);await P(a.user),r("Account created! Please check your email for verification link."),e.value="",t.value=""}catch(a){r(l(a),!0)}}async function g(){const e=document.getElementById("email"),t=document.getElementById("password");if(!e||!t)return;const n=e.value.trim(),s=t.value;if(!n||!s){r("Please enter both email and password",!0);return}if(!u(n)){r("Please enter a valid email address",!0);return}if(!c(`signin_${n}`)){r("Too many login attempts. Please try again later.",!0);return}try{await E(o,n,s),r("Login successful!"),e.value="",t.value=""}catch(a){r(l(a),!0)}}async function M(){try{await B(o),r("Logged out successfully")}catch(e){r(l(e),!0)}}async function O(){const e=document.getElementById("email");let t=e?e.value.trim():"";if(!t&&(t=prompt("Enter your email address:"),!t)){r("Please enter your email address",!0);return}if(!u(t)){r("Please enter a valid email address",!0);return}if(!c(`reset_${t}`)){r("Too many password reset attempts. Please try again later.",!0);return}try{await b(o,t),r("Password reset email sent! Check your inbox.")}catch(n){r(l(n),!0)}}const f=document.getElementById("password");f&&f.addEventListener("keypress",e=>{e.key==="Enter"&&g()});document.getElementById("signUpBtn").addEventListener("click",T);document.getElementById("signInBtn").addEventListener("click",g);document.getElementById("signOutBtn").addEventListener("click",M);document.getElementById("resetPasswordLink").addEventListener("click",function(e){e.preventDefault(),O()});
